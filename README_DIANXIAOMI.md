# ğŸ¤– åº—å°ç§˜ TikTok è®¢å•è‡ªåŠ¨å¤‡æ³¨æœºå™¨äºº

è‡ªåŠ¨ä¸ºæ¥è‡ªTikTokçš„è®¢å•æ·»åŠ ä¹°å®¶TikTokæ˜µç§°å¤‡æ³¨ï¼Œæ–¹ä¾¿è¿è¥ç®¡ç†ã€‚

## âœ¨ åŠŸèƒ½

- âœ… è‡ªåŠ¨è·å–åº—å°ç§˜è®¢å•åˆ—è¡¨
- âœ… æ™ºèƒ½è¯†åˆ«TikTokè®¢å•
- âœ… æå–ä¹°å®¶TikTokæ˜µç§°
- âœ… è‡ªåŠ¨æ·»åŠ è®¢å•å¤‡æ³¨
- âœ… æ”¯æŒæŒç»­ç›‘æ§æ¨¡å¼
- âœ… æ”¯æŒæ¨¡æ‹Ÿè¿è¡Œï¼ˆdry-runï¼‰

## ğŸ“‹ å‰ç½®è¦æ±‚

### 1. åº—å°ç§˜ API æƒé™

éœ€è¦è·å–åº—å°ç§˜çš„ API è®¿é—®æƒé™ï¼š

1. ç™»å½•åº—å°ç§˜åå°
2. è¿›å…¥ã€Œç³»ç»Ÿè®¾ç½®ã€â†’ã€ŒAPIè®¾ç½®ã€
3. ç”³è¯· API Key å’Œ API Secret
4. ç¡®è®¤ API æƒé™åŒ…æ‹¬ï¼š
   - è·å–è®¢å•åˆ—è¡¨
   - è·å–è®¢å•è¯¦æƒ…
   - æ·»åŠ /æ›´æ–°è®¢å•å¤‡æ³¨

### 2. Python ç¯å¢ƒ

```bash
# Python 3.7+
python3 --version

# å®‰è£…ä¾èµ–
pip install requests pyyaml pandas openpyxl
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æ–‡ä»¶

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š

```bash
cp dianxiaomi_config.example.yaml dianxiaomi_config.yaml
```

ç¼–è¾‘ `dianxiaomi_config.yaml`ï¼Œå¡«å…¥ä½ çš„ API ä¿¡æ¯ï¼š

```yaml
dianxiaomi:
  api_key: "ä½ çš„API_Key"
  api_secret: "ä½ çš„API_Secret"
  base_url: "https://openapi.dianxiaomi.com"

tiktok:
  api_enabled: false  # å¦‚æœåº—å°ç§˜è®¢å•æ•°æ®ä¸­å·²æœ‰æ˜µç§°ï¼Œå¯ä»¥è®¾ä¸ºfalse

note_prefix: "TikTokæ˜µç§°: "
```

### 2. æµ‹è¯•è¿è¡Œï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰

é¦–æ¬¡è¿è¡Œå»ºè®®ä½¿ç”¨ `--dry-run` æ¨¡å¼ï¼Œä¸ä¼šå®é™…ä¿®æ”¹è®¢å•ï¼š

```bash
python dianxiaomi_tiktok_bot.py --dry-run
```

### 3. å¤„ç†æŒ‡å®šæ—¶é—´èŒƒå›´çš„è®¢å•

```bash
# å¤„ç†ä»Šå¤©çš„æ‰€æœ‰è®¢å•
python dianxiaomi_tiktok_bot.py \
  --start-time "2024-12-10 00:00:00" \
  --end-time "2024-12-10 23:59:59"

# å¤„ç†æœ€è¿‘1å°æ—¶çš„è®¢å•
python dianxiaomi_tiktok_bot.py \
  --start-time "$(date -v-1H '+%Y-%m-%d %H:%M:%S')"
```

### 4. æŒç»­ç›‘æ§æ¨¡å¼

è‡ªåŠ¨å®šæœŸæ£€æŸ¥æ–°è®¢å•å¹¶æ·»åŠ å¤‡æ³¨ï¼š

```bash
python dianxiaomi_tiktok_bot.py --continuous --interval 300
```

- `--continuous`: å¯ç”¨æŒç»­ç›‘æ§
- `--interval 300`: æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼ˆé»˜è®¤300ç§’ï¼‰

## ğŸ“– ä½¿ç”¨è¯´æ˜

### å‘½ä»¤è¡Œå‚æ•°

```bash
python dianxiaomi_tiktok_bot.py [é€‰é¡¹]

é€‰é¡¹:
  -c, --config FILE      é…ç½®æ–‡ä»¶è·¯å¾„ (é»˜è®¤: dianxiaomi_config.yaml)
  --start-time TIME      å¼€å§‹æ—¶é—´ (æ ¼å¼: YYYY-MM-DD HH:MM:SS)
  --end-time TIME        ç»“æŸæ—¶é—´ (æ ¼å¼: YYYY-MM-DD HH:MM:SS)
  --continuous           æŒç»­è¿è¡Œæ¨¡å¼
  --interval SECONDS     æŒç»­è¿è¡Œæ¨¡å¼çš„æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼Œé»˜è®¤300ï¼‰
  --dry-run              æ¨¡æ‹Ÿè¿è¡Œï¼ˆä¸å®é™…æ·»åŠ å¤‡æ³¨ï¼‰
  -h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹1: å¤„ç†ä»Šå¤©çš„è®¢å•ï¼ˆæ¨¡æ‹Ÿè¿è¡Œï¼‰

```bash
python dianxiaomi_tiktok_bot.py \
  --start-time "2024-12-10 00:00:00" \
  --end-time "2024-12-10 23:59:59" \
  --dry-run
```

#### ç¤ºä¾‹2: å®é™…å¤„ç†æœ€è¿‘1å°æ—¶çš„è®¢å•

```bash
python dianxiaomi_tiktok_bot.py \
  --start-time "$(date -v-1H '+%Y-%m-%d %H:%M:%S')"
```

#### ç¤ºä¾‹3: æŒç»­ç›‘æ§ï¼ˆæ¯10åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰

```bash
python dianxiaomi_tiktok_bot.py --continuous --interval 600
```

## ğŸ”§ å·¥ä½œåŸç†

### 1. è®¢å•è·å–

è„šæœ¬ä»åº—å°ç§˜ API è·å–è®¢å•åˆ—è¡¨ï¼Œæ”¯æŒï¼š
- æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰
- åˆ†é¡µè·å–
- çŠ¶æ€ç­›é€‰

### 2. TikTokè®¢å•è¯†åˆ«

è‡ªåŠ¨è¯†åˆ«TikTokè®¢å•çš„è§„åˆ™ï¼š
- æ£€æŸ¥è®¢å•æ¥æºå­—æ®µï¼ˆplatform/channelï¼‰
- æ£€æŸ¥è®¢å•IDæ ¼å¼
- å…³é”®è¯åŒ¹é…ï¼š`tiktok`, `tk`, `æŠ–éŸ³`, `tiktok shop`

### 3. æ˜µç§°æå–

ä»ä»¥ä¸‹ä½ç½®æå–TikTokæ˜µç§°ï¼š
1. **è®¢å•å­—æ®µ**ï¼š`buyer_nickname`, `tiktok_username`, `customer_name` ç­‰
2. **è®¢å•å¤‡æ³¨**ï¼šä»ç°æœ‰å¤‡æ³¨ä¸­è§£æ
3. **ä¹°å®¶ä¿¡æ¯**ï¼šä» `buyer` æˆ– `customer` å¯¹è±¡ä¸­æå–
4. **TikTok API**ï¼šå¦‚æœåº—å°ç§˜æ•°æ®ä¸­æ²¡æœ‰ï¼Œå¯å°è¯•ä»TikTok APIè·å–

### 4. å¤‡æ³¨æ·»åŠ 

- æ£€æŸ¥è®¢å•æ˜¯å¦å·²æœ‰å¤‡æ³¨
- å¦‚æœå¤‡æ³¨ä¸­å·²åŒ…å«æ˜µç§°ï¼Œåˆ™è·³è¿‡
- å¦åˆ™æ·»åŠ æˆ–è¿½åŠ å¤‡æ³¨ï¼š`TikTokæ˜µç§°: @username`

## âš™ï¸ é…ç½®è¯´æ˜

### åº—å°ç§˜ API é…ç½®

```yaml
dianxiaomi:
  api_key: "ä½ çš„API_Key"          # å¿…å¡«
  api_secret: "ä½ çš„API_Secret"     # å¿…å¡«
  base_url: "https://openapi.dianxiaomi.com"  # APIåœ°å€
```

### TikTok é…ç½®

```yaml
tiktok:
  api_enabled: false  # æ˜¯å¦å¯ç”¨TikTok APIï¼ˆéœ€è¦TikTok Shop APIæƒé™ï¼‰
  api_url: "https://open-api.tiktokglobalshop.com"
  access_token: "ä½ çš„TikTok_Access_Token"
```

### å¤‡æ³¨é…ç½®

```yaml
note_prefix: "TikTokæ˜µç§°: "  # å¤‡æ³¨å‰ç¼€
note_append: true            # æ˜¯å¦è¿½åŠ ï¼ˆTrue=è¿½åŠ åˆ°ç°æœ‰å¤‡æ³¨ï¼ŒFalse=æ›¿æ¢ï¼‰
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: APIè®¤è¯å¤±è´¥

**é”™è¯¯**: `APIé”™è¯¯: è®¤è¯å¤±è´¥`

**è§£å†³**:
1. æ£€æŸ¥ API Key å’Œ API Secret æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ API æƒé™æ˜¯å¦åŒ…å«è®¢å•ç›¸å…³æ“ä½œ
3. æ£€æŸ¥ç­¾åç®—æ³•æ˜¯å¦æ­£ç¡®ï¼ˆå¯èƒ½éœ€è¦æ ¹æ®åº—å°ç§˜å®é™…APIæ–‡æ¡£è°ƒæ•´ï¼‰

### é—®é¢˜2: æ— æ³•è·å–è®¢å•

**é”™è¯¯**: `è·å–è®¢å•å¤±è´¥`

**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤ API ç«¯ç‚¹ URL æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹åº—å°ç§˜ API æ–‡æ¡£ï¼Œç¡®è®¤è¯·æ±‚æ ¼å¼

### é—®é¢˜3: æ— æ³•è¯†åˆ«TikTokè®¢å•

**è§£å†³**:
1. æ£€æŸ¥è®¢å•æ•°æ®ä¸­æ˜¯å¦åŒ…å«å¹³å°æ ‡è¯†
2. åœ¨ `dianxiaomi_api.py` çš„ `filter_tiktok_orders` æ–¹æ³•ä¸­è°ƒæ•´è¯†åˆ«è§„åˆ™
3. æ·»åŠ è‡ªå®šä¹‰å…³é”®è¯

### é—®é¢˜4: æ— æ³•æå–æ˜µç§°

**è§£å†³**:
1. æ£€æŸ¥è®¢å•æ•°æ®ä¸­æ˜¯å¦åŒ…å«æ˜µç§°å­—æ®µ
2. åœ¨ `tiktok_order_parser.py` ä¸­æ·»åŠ æ›´å¤šå­—æ®µå
3. å¯ç”¨ TikTok APIï¼ˆå¦‚æœåº—å°ç§˜æ•°æ®ä¸­æ²¡æœ‰æ˜µç§°ï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **APIé™åˆ¶**: æ³¨æ„åº—å°ç§˜ API çš„è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œé¿å…è¯·æ±‚è¿‡å¿«
2. **æ•°æ®å®‰å…¨**: å¦¥å–„ä¿ç®¡ API Key å’Œ Secretï¼Œä¸è¦æäº¤åˆ°ä»£ç ä»“åº“
3. **æµ‹è¯•å…ˆè¡Œ**: é¦–æ¬¡ä½¿ç”¨å»ºè®®å…ˆç”¨ `--dry-run` æ¨¡å¼æµ‹è¯•
4. **å¤‡ä»½æ•°æ®**: æ‰¹é‡å¤„ç†å‰å»ºè®®å¤‡ä»½è®¢å•æ•°æ®
5. **ç­¾åç®—æ³•**: åº—å°ç§˜çš„ç­¾åç®—æ³•å¯èƒ½éœ€è¦æ ¹æ®å®é™…APIæ–‡æ¡£è°ƒæ•´

## ğŸ”„ è‡ªå®šä¹‰å¼€å‘

### è°ƒæ•´ç­¾åç®—æ³•

å¦‚æœåº—å°ç§˜çš„ç­¾åç®—æ³•ä¸åŒï¼Œä¿®æ”¹ `dianxiaomi_api.py` ä¸­çš„ `_get_signature` æ–¹æ³•ï¼š

```python
def _get_signature(self, params: dict, timestamp: str) -> str:
    # æ ¹æ®åº—å°ç§˜å®é™…APIæ–‡æ¡£å®ç°ç­¾åç®—æ³•
    # ç¤ºä¾‹ï¼šå¯èƒ½æ˜¯ SHA256ã€HMAC ç­‰
    pass
```

### è°ƒæ•´APIç«¯ç‚¹

æ ¹æ®åº—å°ç§˜å®é™…APIæ–‡æ¡£ï¼Œä¿®æ”¹ `dianxiaomi_api.py` ä¸­çš„APIç«¯ç‚¹ï¼š

```python
# è·å–è®¢å•åˆ—è¡¨
return self._request('GET', '/api/v1/orders', params=params)

# æ·»åŠ å¤‡æ³¨
return self._request('POST', '/api/v1/orders/note', data=data)
```

### æ·»åŠ æ›´å¤šæ˜µç§°å­—æ®µ

åœ¨ `tiktok_order_parser.py` ä¸­æ·»åŠ æ›´å¤šå­—æ®µåï¼š

```python
self.nickname_fields = [
    'buyer_nickname',
    'tiktok_username',
    'your_custom_field',  # æ·»åŠ ä½ çš„å­—æ®µ
    # ...
]
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
3. ä½¿ç”¨ `--dry-run` æ¨¡å¼è°ƒè¯•
4. å‚è€ƒåº—å°ç§˜ API æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

MIT License



